Ce plugin permet de retourner les évènements de votre agenda iCalendar, il suffit pour cela de créer un équipement et de lui ajouter autant de "commandes" que vous avez d'agenda à traiter. Même s’il y beaucoups de paramètres, la configuration du plugin est simple : les paramètres par défaut peuvent être conservés, ce qui facilite la création. +
Vous pouvez l’utiliser pour l'affichage d'agenda tout simplement ou pour récupérer des agendas vous permettant de réaliser des actions dans votre installation Jeedom.

''''
=== Plugin Installation und Konfiguration

Après téléchargement du plugin, vous devez l'activer pour profiter de ces fonctionnalité. +
Des paramètres de configuration vous sont proposés, mais les valeurs par défaut peuvent être conservées. +

image:../images/iCalendar_install.PNG[]

[cols="2,2,8", frame="topbot", options="header"]
|=======================
| Parameter	| Typ | Beschreibung
| TimeOut de syncrho | Zone de liste | Cette option vous permet de définir le temps que vous souhaité laissé au plugin pour récupérer les données issus du calendrier distant. +
Théoriquement cette action est assez rapide, mais ce paramètre est disponible en cas de besoin. +
Les valeurs possibles sont : 5 sec / 15 sec / 30 sec.
| Pannel: vue par défaut | Zone de liste | Lorsque vous allez sur l'écran "panel", cette option précise la vue qui sera affiché par défaut pour l'utilisateur. +
Les valeurs possibles sont : +
- Calendrier: jours +
- Calendrier: 4 jours +
- Calendrier: semaine +
- Calendrier: mois +
- Actions: planning
|=======================


''''
=== Beschreibung der Geräteparameter
 
Un bouton "dupliquer", permet de dupliquer l'équipement et les commandes associées. +

image:../images/iCalendar_screenshot2.jpg[]
image:../images/iCalendar_config01.PNG[]
	
[cols="2,2,8", frame="topbot", options="header"]
|=======================
| Parameter	| Typ | Beschreibung
| Nom de l’équipement | Zone de texte | Nom donné à votre équipement agenda iCalendar, il s'affiche sur le widget. + 
*Hinweis :* +
- il est possible de le masquer si vous cocher l'option "Ne pas afficher le nom" dans la configuration de la commande; + 
- ce nom contient également un lien depuis le dashboard permettant de revenir directement à la configuration.
| Objet parent 	| Liste de choix | Associe l'équipement agenda iCalendar à un objet (permettant de définir sa position sur le dashboard)
| Activer	| Checkbox + 
_(décoché par défaut)_ | Si coché, active l'équipement. +
*Remarque :* Si l'option est décochée, l'équipement est désactivé et aucune requête ne sera demandée échangé avec votre agenda externe ; l'équipement est _"en attente"_.
| Visible	| Checkbox +
_(décoché par défaut)_ | Si l'option est cochée, affiche l'équipement. +
*Remarque :* Si l'option est décochée, l'équipement fonctionne normalement; les requêtes continues d'être envoyées vers votre agenda externe, mais il ne s'affiche pas sur votre dashboard.
| Catégorie	| Checkbox + 
_(multichoix)_ | Définie la catégorie à laquelle est rattaché l'agenda.
| Commentaire | Zone de texte | Permet de mettre à commentaire sur l'équipement. + 
3+|=== Paramètres graphiques ===
| Autre Widget	| Checkbox + 
_(décoché par défaut)_ | Cette option vous permet de désactiver le widget standard du plugin et donc d'utiliser le widget jeedom ou de créer son propre widget. + 
_(Il est conseillé de laisser cette option décochée, pour disposer de l'ensemble des fonctionnalités du plugin)._
| Ne pas afficher la date | Checkbox + 
_(décoché par défaut)_ | Si l'option est cochée la date est masquée sur le widget; le texte "aujourd'hui : JJ MOIS AAAA (SW)" n'est pas affiché pour le Dashboard et les vues. +
Au niveau de la version mobile, le logo avec la date du jour n'est pas affiché. 
| Format d'affichage | Zone de liste | Définie le format d'affichage des calendiers, soit en mode verticale (standard) ou en mode horizontale. +
*Remarque:* Ne s'applique que pour la version Dashboard; la version mobile est toujours verticale.
3+|=== Paramètres événements ===
| Ajouter Message sur "action" | Checkbox +
_(décoché par défaut)_ | Cette option permet d'ajouter un message à la boite des messages jeedom, dans le cas où le plugin a déclenché une action, un scénario ou une intéraction. +
*Remarque :* Pour cela, il faut avoir autoriser les actions/scénario ou interaction au niveau de votre commande agenda. + 
Cette option ne fonctionne pas dans le cas d'une utilisation par déclenchement de scénario sur mise à jour de la commande.
| Autorise "Rattrapage" / Période | Checkbox +
_(décoché par défaut)_ +
 +
Liste de choix | L'activation de cette option permet de pouvoir lancer des actions/scénario/intéraction, mais si l'heure exacte de l'événement est dépassé. +
Le plugin dispose alors d'une fenêtre de temps pour déclencher ces actions, si elles n'ont pas été faite dans les temps. +
*Remarque:* Ce paramètre est surtout utile au petite config (RPI1) qui pouvait par moment se retrouve en dehors de la minute de début ou de fin de l'événement et l'action ne se lançait pas. +
_(exemple: événement débute à 8h30, hors à 30, il y a bcq de cron lancé. On pouvait constater que le cron minute était en fait traité à 31 ; l'instant T ne correspondant plus à l'heure de début de l'événement, les actions/sénarios associés étaient ignorées)_ +
Cette option peut aussi être utile en cas de coupure de courant coute, vous pourrez rattraper des actions non exécutées. +
 +
Les périodes disponibles sont : +
- les 2 dernières minutes +
- les 5 dernières minutes +
- les 15 dernières minutes +
- l'heure précédente +
*Remarque:* ces 4 périodes sont en glissante par rapport à l'instant T.
3+|=== Paramètres synchronisation ===
| Fréquence | Liste de choix +
_(30 min, par défaut)_ | L'utilisateur peut configurer la période de rafraîchissement du fichier cache (minimum 30 min) ; (cf. tableau Annexe 2).
|=======================


''''
=== Beschreibung der Befehlsparameter

Un bouton "Ajouter un Agenda", permet de créer un nouvel agenda avec ces propres paramètre de commandes (pour une meilleure lecture, l'affichage présente un tableau par agenda) +

Les agendas peuvent être triés par ordre d'affichage, en cliquant sur l'icône "double flêches" en haut à gauche et en déplaçant le tableau de haut en bas. +


*Remarque:* Le bouton "Aide à la saisie d'actions/scénarios au sein d'un événement" vous permet assister à la création du format à placer dans le champs description de votre événément. +
Pour rappel, le lancement automatiques d'actions par le plugin n'est possible que si l'option activer les actions/scénarios est validée au niveau de votre commande agenda. (cf. Annexe 1 : "Aide à la saisie d'un évènement dans votre agenda").

image:../images/iCalendar_screenshot3.jpg[]

[cols="2,2,8", frame="topbot", options="header"]
|=======================
| Parameter	| Typ | Beschreibung
3+|=== Nom et URL ===
| Nom | Zone de texte | Permet de donner un nom au calendrier ; cette valeur s'affiche dans la zone de titre du calendier sur le widget. 
| Nom ics | Zone de texte | Nom récupéré au niveau du fichier ICS ; valeur non modifiable. 
| Type d'agenda | Zone de liste | Vous permet de définir le type d'agenda que vous configuré et la méthode de récupération de l'ICS. Les choix possibles sont : +
- `récupération d'un fichier ics` : correspond au téléchargement d'un fichier issue d'un serveur tier ; +
- `lecture d'un agenda CalDav` : permet de récuéprer le contenu d'un agenda CalDav et d'avoir un fichier ics local ;
| URL de l'agenda | Zone de texte | Définit l'URL du fichier ics. Pour retrouver l'URL, voir l'Annexe 3.
| Utilisateur | Zone de texte | (s'affiche uniquement en "caldav") +
Permet de définir le nom de l'utilisateur du serveur CalDav.
| Mot de passe | Zone de texte | (s'affiche uniquement en "caldav") +
Permet de définir le mot de passe de l'utilisateur du serveur CalDav.
| Nom agenda | Zone de texte | (s'affiche uniquement en "caldav") +
Caldav offrant la possibilité d'avoir plusieurs agendas actif, vous pouvez spécifié ici le nom de l'agenda à récupérer. +
Ce champs n'est pas obligatoire; s'il est non renseigné, le plugin prendra le 1er agenda retourné par le serveur Caldav ("personnal" généralement). +
*Remarque:* un bouton d'aide vous permet de visualiser la liste des agendas disponibles et de copier le nom de l'agenda souhaité. 
3+|=== Nutzungsdaten ===
| Format donnée | Zone de liste +
_("événement sur la journée" par défaut)_ | Définit le "format" à afficher au niveau du widget et contenu dans la commande ; 3 valeurs sont disponibles (cf. Annexe 4) : +
- `événement sur la journée` : affiche et traite tous les évènements de la journée (passés, en cours, à venir) ; +
- `événement heure à venir` : affiche et traite les événements courants, + ceux de l'heure à venir (même s'ils n'ont pas démarré) ; +
- `événement courant` : affiche et traite les événements en cours uniquement ;
| Titre uniquement | Checkbox + 
_(décoché par défaut)_ | Cette option n'est disponible que si "format de donnée" = " événement courant". +
Le contenu de la commande agenda est alors la plus simpliste possible, elle ne présente que les titres ; tous les paramètres annexes (id, état) à l'événement ne sont pas disponibles. +
*Remarque: Si vous utilisez cette option, l'option "Autoriser les scénarios/actions" sera INVALIDEE techniquement.* +
| Période à traiter | Zone de liste +
_("jour courant" par défaut)_ | Définit le nombre de jours à traier : +
- `jour courant` : gère les données de la journée courante au niveau de la commande "J0" ; +
- `+ lendemain` : gère les données de la journée courante et celles du lendemain (J0+J1) ; +
- `+ 2jours` : gère les données de la journée courante et celles des 2 jours suivants (J0+J1+J2) ; +
- `1 semaine` : gère les données de la journée courante et celles des 6 jours suivants (J0 à J6) ; +
*Remarque:* n'est disponible que si "format de donnée" = "événement sur la journée". +
Dans le cas où vous êtes dans une configuration supérieure à la journée courante, une icône orange apparait à coté du titre; en cliquant dessus, la liste des commandes associées aux autres journées apparait en dessous du tableau. 
| Valeur par défaut | Zone de texte | Valeur affichée par défaut, lorsqu'il n'y a aucun évènement dans le planning. +
*Remarque :* Si rien n'est indiqué, la valeur "Aucun" est retournée. 
| Indicateurs début/fin | Checkbox + 
_(décoché par défaut)_ | Permet de définir si les indicateurs de début/de fin d'évènement sont utilisés, aussi bien à l'affichage et aussi pour l'execution d'une action/scénario; +
- Si coché : les indicateurs "Début" ([yellow-background]#;DA;#) et "Fin" ([yellow-background]#;FA;#) d'activité sont utilisés en complément de l'incidateur "Actif" +
- Si décoché : seul l'indicateur d'état "Actif" est utilisé ([yellow-background]#;A;#).
| Autoriser les scénarios/Actions | Checkbox +
_(décoché par défaut)_ | Cette option permet au plugin de lancer automatiquement les scénarios ou actions, si la description de l'événement respecte correctement le format attendue pour cette action (cf. Annexe 1 : "Aide à la saisie d'un évènement").
| Autoriser les interactions | Checkbox +
_(décoché par défaut)_ | Cette option permet au plugin de lancer une recherche d'interaction sur la base du titre de l'événement. +
*Remarque:* cette option ne s'active uniquement que sur les événements qui n'ont pas d'action/scénario configuré dans leur description. +
| Historiser les actions | Checkbox +
_(décoché par défaut)_ | A chaque action/scénario/interaction lancé par le plugin, l'action produite est tracée (pour ne pas être relancé plus tard). +
Cette option permet conserver ces actions traitées au delà de la journée courante. 
3+|=== Grafische Option ===
| Afficher calendrier | Checkbox + 
_(coché par défaut)_ | Paramètre graphique ; permet de définir si le calendrier doit être affiché dans le widget. + 
*Remarque :* ce paramètre n'est que graphique, il n'impacte pas les données (celles-ci continuent d'être traitées, même si l'option est désactivée). 
| Afficher heure | Checkbox + 
_(coché par défaut)_ | Paramètre graphique ; permet de définir si les heures de début et de fin sont affichées dans le widget. + 
*Remarque :* ce paramètre n'est que graphique, il n'impacte pas les données (l'heure continue d'être présente dans la donnée, même si l'option est désactivée). 
| Afficher heure event de 24h | Checkbox + 
_(coché par défaut)_ | Paramètre graphique ; permet de définir si les heures de début et de fin sont affichées pour les évènements durant toute la journée (24 h) dans le widget. +
Le paramètre n'est pas affiché si l'option "Afficher heure" est décochée. +
*Remarque :* ce paramètre n'est que graphique, il n'impacte pas les données (celles-ci continuent d'être traitées, même si l'option est désactivée). 
| Afficher l'emplacement | Checkbox + 
_(coché par défaut)_ | Paramètre graphique ; permet d'affiché l'information de lieu disponible au niveau de l'événement. +
*Remarque:* Cette information n'est disponible qu'à l'affichage pour l'instant; vous pouvez aussi la récupérer au niveau d'un scénario via la fonction "getLocation".
| Période à afficher | Zone de liste | Définit le nombre de jours à afficher sur le widget : +
- `jour courant` : affiche les données de la journée courante; +
- `+ lendemain` : affiche les données de la journée courante et celles du lendemain; +
- `+ 2jours` : affiche les données de la journée courante et celles des 2 jours suivants; +
- `1 semaine` : affiche les données de la journée courante et celles des 6 jours suivants; +
*Remarque:* le nombre de jours proposé dépend de la valeur sélectionnée au niveau de l'option "Période à traiter".
3+|=== Actions ===
| Paramètre (roue crantée) | | Permet de définir les options "Jeedom" de la commande.
| Tester | | Permet de tester la commande (affiche le contenu de la commande). +
*Remarque :* la donnée s'affiche uniquement après un 1er rafrachissement. 
| Supprimer | | Permet de supprimer la commande et les commandes rattachées (si agenda sur plusieurs jours).
| Id | | Valeur de l'id de la commande ; cet id est créé après l'enregistrement de l'équipement. +
*Remarque :* Cette valeur est utilisée dans les logs, pour identifier les actions réalisées au niveau du plugin. 
3+|=== Informations de synchro ===
| Date du fichier 2+| indique la date du dernier téléchargement et sauvegarde en cache du fichier ics. +
*Remarque:* lors d'une synchronisation, le fichier peut ne pas être sauvegardé en cache, si les 2 fichiers sont identiques. +
Un bouton "télécharger", vous permet de récupérer le fichier actuellement en cache pour une lecture local sur votre poste de travail.
| Date synchro précédente 2+| indique la date de la dernière synchronisation entre jeedom et votre agenda ics.
| Date synchro suivante 2+| indique la date de la prochaine synchronisation entre jeedom et votre agenda ics. +
*Remarque:* si la valeur est "STOP", cela signifie que votre équipement est désactivé.
|=======================

[cols="2,2,8", frame="topbot", options="header"]
|=======================
3+|=== Sicherungsoptionen ===
| Forcer la synchronisation | Checkbox + 
_(décoché par défaut)_ | Permet de forcer la synchronisation du fichier cache en dehors des plages horaires.
|=======================

===== Exemple d'un écran listant les noms des agendas CalDav 

image:../images/iCalendar_caldav1.PNG[]
 +
 +

''''
=== Widget Präsentation

Le widget se présente sous la forme suivante, si aucun style n'est appliqué :

image:../images/iCalendar_screenshot1.jpg[]
image:../images/iCalendar_screenshot6.jpg[]

Au niveau d'un Calendrier :

* Le nombre d'événements est affiché à coté du titre du Calendrier ;
** En passant la souris sur le titre de l'agenda : affiche le type d'affichage, ainsi que les dates de collecte et de valeur ; 
* Les évènements passés sont grisés ; 
* Les évènements en cours sont repérés par une icône "Actif" (mais aussi 1ère minute et dernière minute, si l'option est active) ; 
* Les évènements à venir sont représentés sans indicateur ; 
* Les évènements identifiés avec des actions de type (Scénarios ou Actions) sont représentés par : (seulement si l'option "autoriser les scénarios/actions" est activée) : 
** Une icône "roues crantées" indique que l'événement déclenche des scénarios ou actions ; 
*** en cliquant dessus, la liste des scénarios ou actions configurés en début ou fin d'événement est affichée ; + 
En cliquant une seconde fois, ou sur une autre roue la fenêtre d'information actuelle se masque ;
*** en cliquant sur le nom du scénario ou de l'action, la page de configuration s'ouvre ; 
*** une icône verte apparait sur à coté de l'action/scénario pour indiqué qu'il a bien été exécuté ; +
En passant la sourie sur l'icône, il est possible de voir la date de traitement.
** Une icône "bulle de BD" indique que l'événement peut déclencher une intéraction ; 

La 2nde image montre comment il est possible de personnaliser le widget en utilisant les class (cf. Annexe 6).

==== Andere Eigenschaften :

* Le widget peut être redimensionné en largeur et hauteur ; du moment que les tailles souhaitées soient supérieures à l'espace minimum prévus pour l'affiage des données. 
En cas de dimensionnement inférieur, un message d'erreur est affiché. 

* Vous pouvez également ré-ordonner les agendas directement via le widget (maintenez la souris enfoncée sur la zone de titre de l'agenda, et déplacer vers le haut ou le bas). 


''''
=== Présentation du panel : avec liste des actions historisées et visualisation de l'agenda

Vous pouvez atteindre ce menu en sélectionnant le menu "Accueil", puis "iCalendar". +

*Visualisation de l'agenda :* +

image:../images/iCalendar_screenshot8.jpg[]

Après avoir sélectionné un agenda, vous pouvez cliquer sur le type d'affichage souhaité "Calendrier" (bouton en haut à gauche). +
Vous pouvez alors parcourir votre agenda comme si vous étiez sur la version "distante" (Google, etc...). +
La période d'affichage est toutefois restrainte ; elle respecte la plage suivante : les 3 mois précédents la date du jour et les 6 mois suivants. +

*Remarque:* Cette période n'est pas paramétrage pour l'instant; elle est juste rappelée en haut à droite de l'écran. +
Dans le cas de petite config, le temps d'affichage de cet écran peut être long la 1ère fois de la journée, un cache est ensuite utilisée tout au long de la journée. +
 +
En cliquant sur un événement, une fenêtre apparait, permettant d'avoir des détails complémentaires. +

image:../images/iCalendar_screenshot10.jpg[]
 +
 +
*Actions historisées :* +

image:../images/iCalendar_screenshot9.jpg[]

Si vous avez activer "Historiser les actions", vous pourrez retrouver dans cet écran les actions/scénarios/interactions où une tentative d'exécution a été traitée. + 
En haut à droite, vous pouvez définir la période de visualisation ; par défaut, les derniers jours. +
 +
La liste présente par jour, le nom du scénario ou de l'action traitée, avec son heure de traitement. +
La dernière colonne permet d'avoir des informations sur l'événement associé / ayant demandé le lancement de cette action/scénario. +
Dans le cas d'une intéraction, l'information affichée correspond à la "réponse" retournée par l'intéraction (mais en aucun cas son nom) ; si aucune réponse n'a été faite, il est indiqué "Non reconnu". +
 +
En dessous de la date, vous pouvez supprimer les données historisées pour cette journée. 



''''
=== Nutzung von Daten

* Par configuration d'un événement avec valeur des "scénario/action" dans la description de l'événement : +
Les scénarios et les actions/commandes (si leur id est valide et actif) sont lancés automatiquement à l'heure souhaitée. 

* Par déclencheur dans un scénario : +
Dans une condition IF, il faut rechercher la présence du nom de l'évènement ; on peut aussi le faire précéder de l'état. 
La recherche se fait en utilisant l'argument de comparaison "contient" `~`.

[cols="1,5", width="90%"]
|=======================
| Nom uniquement | recherche de la présence d'un nom : cmd_iCal~"mon event" +
_exemple : \#[MA_CMD]#~"déjeuner"_ 
| Etat actif  | recherche d'un état actif pour un événement précis : cmd_iCal~"A;mon event" +
_exemple : \#[MA_CMD]#~"A;Volet RDC"_ +
*Remarque :* ce test contient aussi les états des 1ère et dernière minutes ; pour ne pas en tenir compte, il faut écrire : +
_\#[MA_CMD]#~";A;Volet RDC"_
| Etat actif : 1ère minute | recherche de la 1ère minute d'un état actif pour un événement précis : cmd_iCal~";DA;mon event" +
_exemple : \#[MA_CMD]#~";DA;Volet RDC"_
| Etat actif : dernière minute | recherche de la dernière minute d'un état actif pour un événement précis : cmd_iCal~";FA;mon event" +
_exemple : \#[MA_CMD]#~";FA;Volet RDC"_ +
*Remarque :* La borne de fin sera configurée 1 minute avant l'heure configurée (exemple pour 18h, l'indicateur sera affiché à 17h59); sauf pour 23h59.
|=======================

En fonction de la version de Jeedom, l'utilisation des doubles côtes `"`, autours du nom de la commande peut être nécessaire ; à partir de la V2, le test doit être fait sans ces doubles côtes.  +

L'utilisation de l'état n'a un intérêt que si le paramètre "Format donnée" utilisé est : "événement heure à venir" ou "événement sur la journée".

*REMARQUE:* Lorsque l'agenda ne traite qu'un seul événément, l'utilisation du format "événement courant" avec "titre uniquement" n'est pas la seule solution. 
Vous pouvez très bien utiliser également les formats "heure à venir" et "journée", en précisant le contenu exacte de l'événement. 
Soit un `\#[MA_CMD]#="Congé"` en "événement courant", équivaut à `\#[MA_CMD]#~";A;Congé;"` dans un autre format (respecter bien l'utilidation des `;`).



''''
=== Cron und Aktualisierungsrate

*Récupération des données :* +
Les données récupérées correspondent à une journée complète, mais sont récupérées en fonction du paramétrage défini (minimum 30 minutes); elles sont enregistrées en cache utilisé par le plugin. +
Si vous faites des modifications dans votre agenda ics, ils ne seront visibles qu'au moment d'une période de rafraîchissement. +

*Cron :* +
Le système vérifie toutes les minutes en cache s'il y a des évènements, et précise l'état de l'évènement (en fonction du format choisi). +
Il est donc possible de configurer/programmer des évènements à la minute près. +

En l'absence d'accès internet, le cache disponible est sur l'ensemble de l'agenda configuré (et non uniquement sur la journée courante). +


''''
=== "Santé" des échanges réseaux

Afin de vous permettre d'avoir une vision sur la validité des synchronisation, une information est remontée au niveau de la page "Santé". +
Dans la session "iCalendar", vous pouvez voir pour chacun de vos agendas, l'état des 15 dernières synchro réalisées:

* Si la synchro s'est correctement déroulée, un `o` est affiché.
* Si la synchro a rencontré un problème réseau (non accès à l'url), une `X` est affichée.

image:../images/iCalendar_screenshot7.jpg[]

L'ordre de lecture de ces états est le suivant : le 1er de la liste correspond au test de synchro le dernier en date ; la dernière information de la liste correspond à l'état le plus ancien connu. +
Ces états sont renseignées à chaque synchro (soit à chaque période définie dans votre configuration de l'équipement, ou au moment de l'enregistrement de l'équipement si vous avez forcée la synchro).

''''
=== Anhänge


==== _Annexe 1 : Aide à la saisie d'un évènement "Action" (scénario ou commande action) dans votre agenda_

Ce paragraphe vous explique comment configurer un évènement agenda pour permettre de lancer automatiquement les scénarios ou des commandes actions. + 
Pour que le plugin reconnaisse que l'évènement est de type "Action", il doit se présenter sous une forme particulière au niveau du champs "description" de l'événement. +

*-- Cas du format "Scénario"* : +
Le format attendu doit être du type : `période (DA ou FA)|sc=id du sénario|nom de la variable=valeur de la variable` +
__exemple : `DA|sc=3|varVolet=ON` __ , pour action à la 1ère minute (DA), lancement du scénario id="3", et passage de variable au scénario (variable "varVolet", avec la valeur "ON").

Il est aussi possible d'activer ou désactiver un scénario par ce procédé ; ces valeurs sont présentes en fin de liste des choix "nom de la variable". +
En saisie manuelle, mettre : "#active" pour activer le scénario ou "#desactive" pour désactiver le scénario. +
Par contre, ne pas mettre de valeur de variable pour que cette action soit prise en compte. +
__exemple : `DA|sc=3|#active` __ +
*Remarque:* ces 2 actions ne permettent pas de lancer le scénario, mais juste agir dessus. +
 +

image:../images/iCalendar_screenshot4.jpg[]

[cols="1,3", options="header", width="90%"]
|=======================
| Feld | Beschreibung
| Type d'action | Définie le type d'action à produire (commande action ou scénario), ici "Scénario"
| 1ère minute : nom du scénario | Sélectionner le scénario à exécuter depuis l'évènement à la 1ère minute.
| 1ère minute : nom de la variable | Sélectionner le nom de la variable à utiliser pour un traitement au niveau du scénario ; cette variable sera utilisée pour faire transiter les informations définies au moment de la 1ère minute. +
_Valeur non obligatoire, si vous n'avez pas besoin de passer de paramètre_  +
*Remarque :* la variable doit être créée avant l'utilisation de l'aide (pour apparaître dans la liste des variables).
| 1ère minute : valeur de la variable | Valeur à passer à la variable lors du démarrage de l'événement (1ère minute), lors de l'état [yellow-background]#;DA;#. +
_Valeur non obligatoire. Exemple : ON_
| dernière minute : nom du scénario | Sélectionner le scénario à exécuter depuis l'évènement à la dernière minute.
| dernière minute : nom de la variable | Sélectionner le nom de la variable à utiliser pour un traitement au niveau du scénario ; cette variable sera utilisée pour faire transiter les informations définies au moment de la dernière minute. +
_Valeur non obligatoire, si vous n'avez pas besoin de passer de paramètre_  +
*Remarque :* la variable doit être créée avant l'utilisation de l'aide (pour apparaître dans la liste des variables).
| dernière minute : valeur de la variable | Valeur à passer à la variable à la fin de l'événement (dernière minute), lors de l'état [yellow-background]#;FA;#. +
_Valeur non obligatoire. Exemple : ON_
| _valeur générée_ | Après avoir cliqué sur le bouton "Générer", cette zone représente la syntaxe générée en fonction des valeurs définies ci-dessus. +
Il est possible de lancer plusieurs sénario à la 1ère minute ou dernière minute. +
Un bouton RAZ permet de remettre à vide la zone. 
|=======================

*-- Cas du format "Action"* : +
Le format attendu doit être du type : `période (DA ou FA)|act=commande(id ou nom)|option de commande=valeur` +
__exemple : `FA|act=[obj][equipment][cmd]|slider=4` __ , pour action à la dernière minute (FA), lancement d'une commande action "cmd" de l'équipement "equipement", et passage de la valeur 4 (commande de type "slider"). +
 +
Remarque : les options de commande sont dépendant de la commande utilisée et donc ne sont pas obligatoires. 

image:../images/iCalendar_screenshot5.jpg[]

[cols="1,3", options="header", width="90%"]
|=======================
| Feld | Beschreibung
| Type d'action | Définie le type d'action à produire (commande action ou scénario), ici "Action"
| Format de la commande | Définie si la valeur de l'ID est positionné ou le format de commande Jeedom (soit [obj][equip][cmd]). +
*Remarque:* avec l'id, vous n'est pas dépendant du nom de la commande ou de l'équipement. Toute modification sur ce dernier n'aura pas d'impact sur le traitement/l'action de la commande. 
| 1ère minute : commande action | Sélectionner le nom de la commande à utiliser à la 1ère minute. +
Si cette commande utilise des options (slider, titre/message), vous pourrez alors les compléter. 
| dernière minute : commande action | Sélectionner le nom de la commande à utiliser à la dernière minute. +
Si cette commande utilise des options (slider, titre/message), vous pourrez alors les compléter. 
|=======================

*-- Opération à réaliser :* +

* Une fois, les informations renseignées, cliquez sur le bouton "Générer". 
* La zone grise est complétée, copiez là (ctrl + C).
* Collez (ctlr + V) l'information dans le champs DESCRIPTION d'un évènement de votre agenda.


*REMARQUE:* les anciens formats de trames au niveau du titre sont encore supportés par le plugin, mais seront bientôt supprimé du plugin au profit de cette nouvelle gestion. +
Pensez à modifier vos configurations pour un traitement avancé du plugin et sa maintenance future. 

''''
==== _Annexe 2 : Fréquence de rafraîchissement_
	
[cols="1,2", options="header", width="50%"]
|=======================
| Valeur | Heure du rafraîchissement
| 30 min. | Aux minutes : 00, 30, de chaque heure.
| 1 h. | A la minute : 00, de chaque heure. 
| 3 h. | A : minuit (00h), 3h, 6h, 9h, 12h, 15h, 18h, 21h.
| 6 h. | A : minuit (00h), 6h, 12h, 18h.
| 12 h. | A : minuit (00h) et midi (12h)
| 24 h. | Unique à minuit (00h)
|=======================
*Remarque :* _en dehors de ces horaires, aucun rafraîchissement n'est réalisé._


''''
==== _Annexe 3 : URL privée des agendas Google_

Une fois connecté à l'agenda Google, vous pouvez récupérer l'*URL PRIVEE* de votre agenda comme ceci. +

- Cliquez sur le nom de l'agenda que vous souhaitez récupérer sous Jeedom et choisir le menu "Paramètres de l'agenda" ; +
- Allez à la session "Adresse URL Privée" et cliquer sur "ICS" ; +
- La popup s'ouvre et présente l'URL à copier dans Jeedom ;


''''
==== _Annexe 4 : Format des données (Widget et structure des commandes)_

Lorsque la synchronisation est réalisée, le plugin va positionner au niveau de la commande agenda, les informations des événements de votre calendrier pour la journée courante. +

Es gibt zwei Formate : 

* version "simple" (diponible pour "événement courant", avec titre uniquement à OUI) : 
** chaque évènement est séparé par des "||" ; 
** la donnée ne contient que les titres des événements, aucune autre information "technique" n'est présente dans la commande ; 

* version standard/complète (pour tout autre paramétrage) : 

** chaque évènement est séparé par des "||" ; 
** les données au sein d'un évènement sont séparés par des ";" (point-virgule) ;
** Die verfügbaren Daten sind : 
*** `heure_début;heure_fin;statut;titre de l'événement;uid;doAct/doInter;date_update;location`
*** où heure_début, et heure_fin sont des bornes de l'événement pour la journée courante ; 
*** statut : définie l'état de l'événement à l'instant T; pouvant prendre les valeurs : vide (à venir), DA (1ère minute), A (actif) ,FA (dernière minute), P (passé) ; 
*** uid : est l'idée technique de l'événement (utilisée pour la liaison avec des données techniques en caches) ; 
*** doAct/doInter : définie si cet événement présente des commandes actions ou scénarios à éxecuter en début ou fin d'événement ; ou une intéraction en début d'événement.
*** date_update : correspond au timestamps update de l'événement ;
*** location : correspond au lieu de l'événement s'il est définie dans votre agenda.

*Hinweis :*

* le plugin sait gérer différents formats d'évènement : 
** heure au sein d'une journée (ex : 23/02 de 10h à 11h) ;
** journée complète (ex : 23/02, généralement décrit 23/02 0h à 24/02 0h) : sera transformé en 23/02 0h-23h59 au niveau de la commande et du widget
** plusieurs journées (ex : 23-25/02) : sera transformé en fonction du jour : 23/02 0h-23h59 , 24/02 0h-23h59, 25/02 0h-23h59
** plusieurs journées avec horaire (ex : 23/02 à 10h et 25/02 à 14h) : sera transformé en fonction du jour : 23/02 10h-23h59, 24/02 0h-23h59, 25/02 0h-14h


''''
==== _Annexe 5 : Données des évenements au niveau des scénarios via "fonctions"_

Pour rappel, une commande agenda retourne des données brutes restectant les formats de données décrits au niveau de l'annexe précédente. +
Toutefois une commande complémentaire est disponible au niveau de chaque "agenda", nommé `_nom de la commande agenda_ (ExecuteFunction-_idCommande_)` +
Cette commande disponible au niveau des scénarios est de type "message" et est composé d'un nom de fonction (titre) et d'argements (message). +
Après avoir sélectionné cette commande dans une action de scénario, tapez la lettre "g" dans la zone "fonction", les fonctions disponibles apparaitront (avec en mémo, un rappel de l'utilisation au niveau des arguments). +
 +
*L'événement recherché ne peut être que sur la journée courante et doit être en cours ou à venir.* Les événements passés ne peuvent plus être analysés. +

*Le titre passé en argument doit être exacte* également (exemple : absence) ; la fonction "contient" n'est pas encore mise en place. +
Si plusieurs titres correspondent, le 1er est retourné. +

[cols="1,2,3", width="95%"]
|=======================
| Funktion | Beschreibung | Argumente
| getTimeStart | donne l'heure de début de l'événement choisit | - en 1ère ligne : mettre le titre de l'événenement à rechercher, le texte doit être exacte ; +
soit [yellow-background]#title=xxx#, exemple : title=Volet RDC +
- en 2nde ligne, il est possible de préciser un format de retour pour la date ; comme dans tout le reste au niveau de jeedom, les possibilités de format sont équivalent à ceux de php. +
soit [yellow-background]#date=xxx#, exemple : date=H:i:s ou date=d/m H:i +
*Remarque:* Si cette 2nde ligne n'est pas renseignée, la valeur retournée est au format timestamp.
| getTimeEnd | donne l'heure de fin de l'événement choisit | - en 1ère ligne : mettre le titre de l'événenement à rechercher, le texte doit être exacte ; +
soit [yellow-background]#title=xxx#, exemple : title=Volet RDC +
- en 2nde ligne, il est possible de préciser un format de retour pour la date ; comme dans tout le reste au niveau de jeedom, les possibilités de format sont équivalent à ceux de php. +
soit [yellow-background]#date=xxx#, exemple : date=H:i:s ou date=d/m H:i +
*Remarque:* Si cette 2nde ligne n'est pas renseignée, la valeur retournée est au format timestamp.
| getUid | donne l'id technique de l'événement choisit | - en 1ère ligne : mettre le titre de l'événenement à rechercher, le texte doit être exacte ; +
soit [yellow-background]#title=xxx#, exemple : title=Volet RDC
| getTitle | donne le titre de l'événement choisit en fonction d'un id | - en 1ère ligne : mettre l'id (uid) de l'événenement à rechercher, le texte doit être exacte ; +
soit [yellow-background]#uid=xxx#, exemple : uid=23424houi877sdf@google.com
| getLocation | donne le lieu de l'événement choisit en fonction d'un id ou d'un titre | - en 1ère ligne : mettre le titre de l'événenement à rechercher, le texte doit être exacte ; +
soit [yellow-background]#title=xxx#, exemple : title=Volet RDC +
(un id peut aussi être passé en paramètre; exemple: uid=23424houi877sdf@google.com)
| getDaySimple | retourne une trame simplifiée de tous les événements de la journée courante (quelque soit le statut de l'événement). +
Le contenu est : l'heure de début, l'heure de fin et le titre. | aucun (zone laissée vide)
| getDayTitleOnly | retourne une trame simplifiée avec tous les événéments de la journée courante (quelque soit le statut de l'événement). +
Le contenu est : uniquement le titre. +
Remarque: cette fonction correspond à la même chose que l'option "titre uniquement", mais ici valable sur toute la journée. | aucun (zone laissée vide)
| getDayActifOnly | retourne une trame simplifiée avec uniquement les événéments actif de la journée courante. +
Le contenu est : l'heure de début, l'heure de fin et le titre. +
Remarque: cette fonction correspond à la même chose que l'option format donnée = "événement courant". | aucun (zone laissée vide)
| getDayActifAndTitleOnly | retourne une trame simplifiée avec uniquement les événements actif de la journée courante. +
Le contenu est : uniquement le titre. +
Remarque: cette fonction correspond à la même chose que l'option format donnée = "événement courant" et "titre uniquement". | aucun (zone laissée vide)
|=======================

Les commandes actions ne retournent pas de valeur, le résultat de la fonction sera donc placée dans une variable de scénario, prenant la forme : `nomDeLaFonction_IdCommandeAgenda` (exemple: getTimeStart_13456). +
Pour éviter toute erreur, cet id est rappelé dans le nom de la commande fonction. +
 + 
Par ailleurs, le traitement étant asynchrone, tout au long du traitement de la commande/fonction la variable de retour est positionnée à "-99". +
Dès lors que cette variable passe à une autre valeur, cela signifie que la fonction a termné son traitement. +
 +
Si la fonction n'a rien trouvé ou a rencontré une erreur, la valeur de retour de non traitement est "-1". +
 +
*Remarque pour les fonction "getDay...":* +
1/ pour l'utilisation de ces fonctions, il est consillé d'être dans un format de donnée différent de "événement courant". 
En effet, ce format étant déjà très limité, ces fonctions spécifiques de formatage de la trame pourraient ne pas s'appliquer. +
Si ce cas s'applique, le retour prendra la valeur "-1" et un message d'erreur sera précisée dans la log. +
2/ le séparateur entre les événements est un double pipe "||". + 
Si vous souhaitez utiliser un autre séparateur pour de l'affichage dans  un mail par exemple, vous pouvez faire un changement de caractère comme suite (ici retour à la ligne) : +
`str_replace("||", "\n", variable(getDaySimple_123))` +
 +
 
===== Processus d'utilisation dans un scénario : 

* 1/ Sélectionner votre commande agenda permettant d'excuter des fonctions au niveau d'une zone "action".
* 2/ Dans la zone "fonction", taper "get" et sélectionner dans la liste la fonction souhaitée (cf. ci-dessus).
* 3/ Ajouter une commande action avec la fonction "wait" ; +
*Remarque:* les temps de réponses des fonctions sont relativement rapide, mais il est préférable d'avoir une tempo pour s'assurer que la valeur retournée est bien celle attendue, pour la suite du scénario. +
La saisie doit être du type : `variable(getTimeEnd_12345) != -99` , (avec un timeout de 5sec par exemple). +
* 4/ une fois cette condition passée, vous pouvez utiliser votre variable dans la suite du scénario. +
*Remarque:* Il est conseillé de faire d'abord un test sur la pertinence de votre variable : autre que "-1".



image:../images/iCalendar_scenarioFonction.PNG[]


''''
==== _Anhang 6 : verfügbare CSS-Klassen_

Vous pouvez utiliser 3 paramètres au niveau des options de la tuille de l'agenda pour gérer les couleurs : 
[cols="1,2", width="70%"]
|=======================
| bgColor | Couleur de fond de la tuille
| bgTitleColor | Couleur de fond de la zone de titre (nom de l'agenda, et zone actions)
| bgItemColor | Couleur de fond de la zone de liste (événements et actions)
|=======================

Mais pour les utiliseurs qui veulent aller plus loin dans la configuration, voici les classes CSS disponibles pour personnaliser le widget du plugin : 

[cols="1,2", width="70%"]
|=======================
| iCalendar_title | Zone de titre de la tuile
| iCalendar_date | Zone de date de la tuile
| iCalendar_calTitle | Zone de titre de l'agenda
| iCalendar_items | Zone d'information principale
| iCalendar_itemActif | évènement "Actif" (en cours) 
| iCalendar_itemInactif | évènement "Inactif" (passé ou à venir)
| iCalendar_zoneListAct | Sur fenêtre affichant la liste des actions / scénarios
| iCalendar_titleListAct | Zone de titre de la liste des actions / scénarios
|=======================
